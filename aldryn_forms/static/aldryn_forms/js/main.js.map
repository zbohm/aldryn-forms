{"version":3,"sources":["webpack://aldryn-forms/./aldryn_forms/static/aldryn_forms/js/src/form.js","webpack://aldryn-forms/./aldryn_forms/static/aldryn_forms/js/src/main.js"],"names":["populate","text","obj","key","value","Object","entries","pattern","RegExp","replace","handleFormRequiredCheckbox","event","form","target","closest","element","querySelectorAll","parentNode","removeChild","button","disabled","readOnly","disableButtonSubmit","display_message","blur","insertAdjacentHTML","gettext","handleRequiredFields","requiredFieldsFulfilled","checkboxset","this","getElementsByClassName","chosen","length","parseInt","dataset","required_min","preventDefault","window","document","addEventListener","getElementsByTagName","getAttribute","classList","contains"],"mappings":"mBAOA,SAASA,EAASC,EAAMC,GAEpB,IAAK,MAAOC,EAAKC,KAAUC,OAAOC,QAAQJ,GAAM,CAC5C,MAAMK,EAAU,IAAIC,OAAO,OAAOL,QAAW,KAC7CF,EAAOA,EAAKQ,QAAQF,EAASH,GAEjC,OAAOH,EAIJ,SAASS,EAA2BC,GAEvC,MAAMC,EAAOD,EAAME,OAAOC,QAAQ,QAClC,GAAIF,EAAM,CAEN,IAAK,MAAMG,KAAWH,EAAKI,iBAAiB,wDACxCD,EAAQE,WAAWC,YAAYH,GAGnC,IAAK,MAAMI,KAAUP,EAAKI,iBAAiB,iBACvCG,EAAOC,UAAW,EAClBD,EAAOE,UAAW,GAKvB,SAASC,EAAoBX,EAAOY,GAEvCZ,EAAME,OAAOW,OACb,IAAK,MAAML,KAAUR,EAAME,OAAOG,iBAAiB,iBAC/CG,EAAOC,UAAW,EAClBD,EAAOE,UAAW,EACdE,GACAJ,EAAOM,mBACH,WACA,iEACEC,QAAQ,mCACR,UAKX,SAASC,EAAqBhB,GAEjC,IAAIiB,GAA0B,EAC9B,IAAK,MAAMC,KAAeC,KAAKC,uBAAuB,iBAAkB,CACpE,MAAMC,EAASH,EAAYb,iBAAiB,gCAAgCiB,OACxED,EAASE,SAASL,EAAYM,QAAQC,gBACtCR,GAA0B,EAC1BC,EAAYJ,mBACR,WACA,mEACEzB,EAAS0B,QAAQ,sEAAuE,CACtFtB,MAAOyB,EAAYM,QAAQC,aAAcJ,OAAQA,IACnD,WAId,GAAIJ,EAEA,IAAK,MAAMT,KAAUW,KAAKd,iBAAiB,iBACvCG,EAAOM,mBACH,WACA,iEACEC,QAAQ,mCACR,cAEP,CAEHf,EAAM0B,iBACN,IAAK,MAAMlB,KAAUW,KAAKd,iBAAiB,iBACvCG,EAAOM,mBACH,WAAY,iEACVC,QAAQ,qCAAuC,WA7E1C,mBAAZA,UACPY,OAAOZ,QAAUzB,GAAQA,GCD7BsC,SAASC,iBAAiB,oBAAoB,KAG1C,IAAK,MAAM5B,KAAQ2B,SAASE,qBAAqB,QAC7C,GAAI7B,EAAK8B,aAAa,cAEb9B,EAAK+B,UAAUC,SAAS,wBACzBhC,EAAK4B,iBAAiB,UAAW7B,GAAUW,EAAoBX,GAAO,SAEvE,CAEEC,EAAK+B,UAAUC,SAAS,wBACzBhC,EAAK4B,iBAAiB,UAAW7B,GAAUW,EAAoBX,GAAO,KAE1EC,EAAK4B,iBAAiB,SAAUb,GAEhC,IAAK,MAAMZ,KAAWH,EAAKI,iBAAiB,uCACxCD,EAAQyB,iBAAiB,QAAS9B,Q","file":"main.js","sourcesContent":["/* global gettext */\n\n// Prevent a situation when the translation is not implemented.\nif (typeof gettext !== \"function\") {\n    window.gettext = text => text\n}\n\nfunction populate(text, obj) {\n    // Map values to the text. E.g. \"Text %(value)s.\"\n    for (const [key, value] of Object.entries(obj)) {\n        const pattern = new RegExp(`%\\\\(${key}\\\\)s`, 'g')\n        text = text.replace(pattern, value)\n    }\n    return text\n}\n\n\nexport function handleFormRequiredCheckbox(event) {\n    // The event.target is a checkbox - this is the result of selector: .form-required input[type=checkbox]\n    const form = event.target.closest(\"form\")\n    if (form) {\n        // Remove error messages if there are any.\n        for (const element of form.querySelectorAll(\".aldryn-forms-required-msg, .aldryn-forms-submit-msg\")) {\n            element.parentNode.removeChild(element)\n        }\n        // Enable submit button.\n        for (const button of form.querySelectorAll('[type=submit]')) {\n            button.disabled = false\n            button.readOnly = false\n        }\n    }\n}\n\nexport function disableButtonSubmit(event, display_message) {\n    // Disable button submit to prevent user click more than once.\n    event.target.blur()\n    for (const button of event.target.querySelectorAll('[type=submit]')) {\n        button.disabled = true\n        button.readOnly = true\n        if (display_message) {\n            button.insertAdjacentHTML(\n                'afterend',\n                '<div class=\"text-danger aldryn-forms aldryn-forms-submit-msg\">'\n                + gettext(\"Please wait. Submitting form...\")\n                + '</div>')\n        }\n    }\n}\n\nexport function handleRequiredFields(event) {\n    // Handle required fields.\n    let requiredFieldsFulfilled = true\n    for (const checkboxset of this.getElementsByClassName(\"form-required\")) {\n        const chosen = checkboxset.querySelectorAll(\"input[type=checkbox]:checked\").length\n        if (chosen < parseInt(checkboxset.dataset.required_min)) {\n            requiredFieldsFulfilled = false\n            checkboxset.insertAdjacentHTML(\n                'afterend',\n                '<div class=\"text-danger aldryn-forms aldryn-forms-required-msg\">'\n                + populate(gettext(\"You have to choose at least %(value)s options (chosen %(chosen)s).\"), {\n                    value: checkboxset.dataset.required_min, chosen: chosen})\n                + '</div>')\n        }\n    }\n    // Do not submit the form if any required fields are missing.\n    if (requiredFieldsFulfilled) {\n        // Display a message to inform the user that the form has been submitted.\n        for (const button of this.querySelectorAll('[type=submit]')) {\n            button.insertAdjacentHTML(\n                'afterend',\n                '<div class=\"text-danger aldryn-forms aldryn-forms-submit-msg\">'\n                + gettext(\"Please wait. Submitting form...\")\n                + '</div>')\n        }\n    } else {\n        // Some required value is not set.\n        event.preventDefault()\n        for (const button of this.querySelectorAll('[type=submit]')) {\n            button.insertAdjacentHTML(\n                'afterend', '<div class=\"text-danger aldryn-forms aldryn-forms-submit-msg\">'\n                + gettext(\"Correct the errors first, please.\") + '</div>')\n        }\n    }\n}\n","import {disableButtonSubmit, handleRequiredFields, handleFormRequiredCheckbox} from './form'\n\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    // Disable button submit to prevent user click more than once.\n    // Do not submit the form if any required fields are missing.\n    for (const form of document.getElementsByTagName(\"form\")) {\n        if (form.getAttribute(\"novalidate\")) {\n            // Skip forms with class skip-disable-submit.\n            if (!form.classList.contains(\"skip-disable-submit\")) {\n                form.addEventListener('submit', (event) => disableButtonSubmit(event, true))\n            }\n        } else {\n            // Skip forms with class skip-disable-submit.\n            if (!form.classList.contains(\"skip-disable-submit\")) {\n                form.addEventListener('submit', (event) => disableButtonSubmit(event, false))\n            }\n            form.addEventListener('submit', handleRequiredFields)\n            // Enable submit button if required were set.\n            for (const element of form.querySelectorAll(\".form-required input[type=checkbox]\")) {\n                element.addEventListener('click', handleFormRequiredCheckbox)\n            }\n        }\n    }\n})\n"],"sourceRoot":""}